(()=>{"use strict";function t(t,e=document.createElement("canvas")){const s=e.getContext("2d",t);if(!s)throw new Error("Could not create a 2D context.");return s}function e(t,e,s){return t+(e-t)*s}function s(t,e,s){return s<t?t:s>e?e:s}var i,r,n;function a(t,s=0,i=1){return e(s,i,t=t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2)}function o(t=7.5625,s=2.75){return(i,r=0,n=1)=>(i<1/s?i*=t*i:i=i<2/s?t*(i-=1.505/s)*i+.75:i<2.5/s?t*(i-=2.25/s)*i+.9375:t*(i-=2.625/s)*i+.984375,e(r,n,i))}function h(t,...e){const s={[t.name]:t},i=Object.getOwnPropertyDescriptor(s,t.name);if(i)for(let r=e.length-1;r>=0;r--)e[r](s,t.name,i)}function c(t){return function(e,s,i){i.value.prototype.name=t??s,i.value.prototype.threadable=!0}}!function(t){t[t.Vertical=1]="Vertical",t[t.Horizontal=2]="Horizontal"}(i||(i={})),function(t){t[t.Top=4]="Top",t[t.Bottom=8]="Bottom",t[t.Left=16]="Left",t[t.Right=32]="Right"}(r||(r={})),function(t){t[t.Middle=3]="Middle",t[t.Top=5]="Top",t[t.Bottom=9]="Bottom",t[t.Left=18]="Left",t[t.Right=34]="Right",t[t.TopLeft=20]="TopLeft",t[t.TopRight=36]="TopRight",t[t.BottomLeft=24]="BottomLeft",t[t.BottomRight=40]="BottomRight"}(n||(n={})),function(t=7.5625,e=2.75){o(t,e)}(),o(),function(t=7.5625,e=2.75){o(t,e)}();class l extends Error{constructor(t,e){super(t),this.remarks=e}}const u=[];function d(){const t=u.at(-1);if(!t)throw new l("The thread is not available in the current context.","<p><code>useThread()</code> can only be called from within generator functions.\n      It&#39;s not available during rendering.</p>\n");return t}function*p(t,e,s){const i=d(),r=i.time(),n=i.time()+t;for(e(0,0);n>i.fixed;){const s=i.fixed-r;s>0&&e(s/t,s),yield}i.time(n),e(1,t),s?.(1,t)}h(p,c());const y=[];function f(){return y.at(-1)?.logger??console}function g(t,e){const s=Object.getPrototypeOf(t);s.threadable||(s.threadable=!0,s.name="string"==typeof e?e:function(t){return Object.getPrototypeOf(t).name??null}(e))}function m(t,e){let s;return"string"==typeof t?(s=e(),g(s,t)):(s=t(),g(s,s)),s}const b=[];function*v(t=0,e){const s=d(),i=function(){const t=b.at(-1);if(!t)throw new Error("The playback is not available in the current context.");return t}().framesToSeconds(1),r=s.time()+t;for(;r-i>s.fixed;)yield;s.time(r),e&&(yield*e)}h((function*(t,e){yield*v(function(t){const e=function(){const t=y.at(-1);if(!t)throw new Error("The scene is not available in the current context.");return t}(),s=d();return e.timeEvents.register(t,s.time())}(t)),e&&(yield*e)}),c()),h(v,c());class w{constructor(){this.subscribable=new S(this),this.subscribers=new Set}subscribe(t){return this.subscribers.add(t),()=>this.unsubscribe(t)}unsubscribe(t){this.subscribers.delete(t)}clear(){this.subscribers.clear()}notifySubscribers(t){return[...this.subscribers].map((e=>e(t)))}}class S{constructor(t){this.dispatcher=t}subscribe(t){return this.dispatcher.subscribe(t)}unsubscribe(t){this.dispatcher.unsubscribe(t)}}class k extends w{constructor(){super(...arguments),this.value=!1}raise(){this.value||(this.value=!0,this.notifySubscribers())}reset(){this.value=!1}isRaised(){return this.value}subscribe(t){const e=super.subscribe(t);return this.value&&t(),e}}class x{static collectPromise(t,e=null){const s={promise:t,value:e,stack:(new Error).stack},i=this.collectionStack.at(-1);return i&&(s.owner=i.owner),t.then((t=>{s.value=t,i?.markDirty()})),this.promises.push(s),s}static hasPromises(){return this.promises.length>0}static async consumePromises(){const t=[...this.promises];return await Promise.all(t.map((t=>t.promise))),this.promises=this.promises.filter((e=>!t.includes(e))),t}constructor(t){this.owner=t,this.dependencies=new Set,this.event=new k,this.markDirty=()=>this.event.raise(),this.invokable=this.invoke.bind(this),Object.defineProperty(this.invokable,"context",{value:this}),Object.defineProperty(this.invokable,"toPromise",{value:this.toPromise.bind(this)})}invoke(){}startCollecting(){if(x.collectionSet.has(this))throw new l("A circular dependency occurred between signals.","This can happen when signals reference each other in a loop.\n        Try using the attached stack trace to locate said loop.");x.collectionSet.add(this),x.collectionStack.push(this)}finishCollecting(){if(x.collectionSet.delete(this),x.collectionStack.pop()!==this)throw new Error("collectStart/collectEnd was called out of order.")}clearDependencies(){this.dependencies.forEach((t=>t.unsubscribe(this.markDirty))),this.dependencies.clear()}collect(){const t=x.collectionStack.at(-1);t&&(t.dependencies.add(this.event.subscribable),this.event.subscribe(t.markDirty))}dispose(){this.clearDependencies(),this.event.clear(),this.owner=null}async toPromise(){do{await x.consumePromises(),this.invokable()}while(x.hasPromises());return this.invokable}}function T(t){return"function"==typeof t}function M(t,e){return T(t)?()=>e(t()):e(t)}x.collectionSet=new Set,x.collectionStack=[],x.promises=[];const I=Symbol.for("@motion-canvas/core/signals/default");class P extends x{constructor(t,e,s=void 0,i=(t=>t),r={}){super(s),this.initial=t,this.interpolation=e,this.parser=i,Object.defineProperty(this.invokable,"reset",{value:this.reset.bind(this)}),Object.defineProperty(this.invokable,"save",{value:this.save.bind(this)}),Object.defineProperty(this.invokable,"isInitial",{value:this.isInitial.bind(this)}),void 0!==this.initial&&(this.current=this.initial,this.markDirty(),T(this.initial)||(this.last=this.parse(this.initial))),this.extensions={getter:this.getter.bind(this),setter:this.setter.bind(this),tweener:this.tweener.bind(this),...r}}toSignal(){return this.invokable}parse(t){return this.parser(t)}set(t){return this.extensions.setter(t),this.owner}setter(t){return t===I&&(t=this.initial),this.current===t||(this.current=t,this.markDirty(),this.clearDependencies(),T(t)||(this.last=this.parse(t))),this.owner}get(){return this.extensions.getter()}getter(){if(this.event.isRaised()&&T(this.current)){this.clearDependencies(),this.startCollecting();try{this.last=this.parse(this.current())}catch(e){f().error({...(t=e,{message:t.message,stack:t.stack,remarks:t.remarks}),inspect:this.owner?.key})}this.finishCollecting()}var t;return this.event.reset(),this.collect(),this.last}invoke(t,e,s=a,i=this.interpolation){return void 0===t?this.get():void 0===e?this.set(t):this.createQueue(s,i).to(t,e)}createQueue(t,e){const s=this.get(),i=[],r=m("animation chain",(function*(){for(;i.length>0;)yield*i.shift()}));return r.to=(s,n,a=t,o=e)=>(t=a,e=o,i.push(this.tween(s,n,a,o)),r),r.back=(n,a=t,o=e)=>(t=a,e=o,i.push(this.tween(s,n,t,e)),r),r.wait=t=>(i.push(v(t)),r),r.run=t=>(i.push(t),r),r.do=t=>(i.push(m((function*(){t()}))),r),r}*tween(t,e,s,i){t===I&&(t=this.initial),yield*this.extensions.tweener(t,e,s,i),this.set(t)}*tweener(t,e,s,i){const r=this.get();yield*p(e,(e=>{this.set(i(r,this.parse(function(t){return T(t)?t():t}(t)),s(e)))}))}dispose(){super.dispose(),this.initial=void 0,this.current=void 0,this.last=void 0}reset(){return void 0!==this.initial&&this.set(this.initial),this.owner}save(){return this.set(this.get())}isInitial(){return this.collect(),this.current===this.initial}raw(){return this.current}}class C extends P{constructor(t,s,i,r,n=void 0,a={}){var o;super(void 0,r,n,s,a),this.entries=t,this.signals=[],this.parser=s;for(const r of t){let t,a;Array.isArray(r)?([t,a]=r,(o=a.context).owner??(o.owner=this)):(t=r,a=new P(M(i,(t=>s(t)[r])),e,n??this.invokable).toSignal()),this.signals.push([t,a]),Object.defineProperty(this.invokable,t,{value:a})}}toSignal(){return this.invokable}parse(t){return this.parser(t)}getter(){return this.parse(Object.fromEntries(this.signals.map((([t,e])=>[t,e()]))))}setter(t){if(T(t))for(const[e,s]of this.signals)s((()=>this.parser(t())[e]));else{const e=this.parse(t);for(const[t,s]of this.signals)s(e[t])}return this.owner}reset(){for(const[,t]of this.signals)t.reset();return this.owner}save(){for(const[,t]of this.signals)t.save();return this.owner}}const R=180/Math.PI,E=Math.PI/180;class D{static createSignal(t,e=D.lerp,s){return new C(["x","y"],(t=>new D(t)),t,e,s).toSignal()}static lerp(t,s,i){let r,n;return"number"==typeof i?r=n=i:(r=i.x,n=i.y),new D(e(t.x,s.x,r),e(t.y,s.y,n))}static arcLerp(t,i,r,n=!1,a){return a??(a=t.sub(i).ctg),D.lerp(t,i,function(t,i,r){let n=i;r>1?r=1/r:n=!n;const a=e(n?Math.acos(s(-1,1,1-t)):Math.asin(t),e(0,Math.PI/2,t),r);let o=Math.sin(a),h=1-Math.cos(a);return i&&([o,h]=[h,o]),new D(o,h)}(r,n,a))}static createArcLerp(t,e){return(s,i,r)=>D.arcLerp(s,i,r,t,e)}static fromOrigin(t){const e=new D;return t===n.Middle||(t&r.Left?e.x=-1:t&r.Right&&(e.x=1),t&r.Top?e.y=-1:t&r.Bottom&&(e.y=1)),e}static fromScalar(t){return new D(t,t)}static fromRadians(t){return new D(Math.cos(t),Math.sin(t))}static fromDegrees(t){return D.fromRadians(t*E)}static radians(t,e){return Math.atan2(e,t)}static degrees(t,e){return D.radians(t,e)*R}static magnitude(t,e){return Math.sqrt(t*t+e*e)}static squaredMagnitude(t,e){return t*t+e*e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}get magnitude(){return D.magnitude(this.x,this.y)}get squaredMagnitude(){return D.squaredMagnitude(this.x,this.y)}get normalized(){return this.scale(1/D.magnitude(this.x,this.y))}get safe(){return new D(isNaN(this.x)?0:this.x,isNaN(this.y)?0:this.y)}get flipped(){return new D(-this.x,-this.y)}get floored(){return new D(Math.floor(this.x),Math.floor(this.y))}get perpendicular(){return new D(this.y,-this.x)}get radians(){return D.radians(this.x,this.y)}get degrees(){return D.degrees(this.x,this.y)}get ctg(){return this.x/this.y}constructor(t,e){if(this.x=0,this.y=0,null!=t){if("object"!=typeof t)return this.x=t,void(this.y=e??t);if(Array.isArray(t))return this.x=t[0],void(this.y=t[1]);if("width"in t)return this.x=t.width,void(this.y=t.height);this.x=t.x,this.y=t.y}}lerp(t,e){return D.lerp(this,t,e)}getOriginOffset(t){const e=D.fromOrigin(t);return e.x*=this.x/2,e.y*=this.y/2,e}scale(t){return new D(this.x*t,this.y*t)}transformAsPoint(t){return new D(this.x*t.m11+this.y*t.m21+t.m41,this.x*t.m12+this.y*t.m22+t.m42)}transform(t){return new D(this.x*t.m11+this.y*t.m21,this.x*t.m12+this.y*t.m22)}mul(t){const e=new D(t);return new D(this.x*e.x,this.y*e.y)}div(t){const e=new D(t);return new D(this.x/e.x,this.y/e.y)}add(t){const e=new D(t);return new D(this.x+e.x,this.y+e.y)}sub(t){const e=new D(t);return new D(this.x-e.x,this.y-e.y)}dot(t){const e=new D(t);return this.x*e.x+this.y*e.y}mod(t){const e=new D(t);return new D(this.x%e.x,this.y%e.y)}addX(t){return new D(this.x+t,this.y)}addY(t){return new D(this.x,this.y+t)}toSymbol(){return D.symbol}toString(){return`Vector2(${this.x}, ${this.y})`}serialize(){return{x:this.x,y:this.y}}exactlyEquals(t){return this.x===t.x&&this.y===t.y}equals(t,e=1e-6){return Math.abs(this.x-t.x)<=e+Number.EPSILON&&Math.abs(this.y-t.y)<=e+Number.EPSILON}}D.symbol=Symbol.for("@motion-canvas/core/types/Vector2"),D.zero=new D,D.one=new D(1,1),D.right=new D(1,0),D.left=new D(-1,0),D.up=new D(0,1),D.down=new D(0,-1);class A{get canvasSize(){return this.size.scale(this.resolutionScale)}constructor(){this.background=null,this.resolutionScale=1,this.colorSpace="srgb",this.size=D.zero,this.finalBuffer=document.createElement("canvas"),this.currentBuffer=document.createElement("canvas"),this.previousBuffer=document.createElement("canvas");const e=this.colorSpace;this.context=t({colorSpace:e},this.finalBuffer),this.currentContext=t({colorSpace:e},this.currentBuffer),this.previousContext=t({colorSpace:e},this.previousBuffer)}configure({colorSpace:e=this.colorSpace,size:s=this.size,resolutionScale:i=this.resolutionScale,background:r=this.background}){e!==this.colorSpace&&(this.colorSpace=e,this.context=t({colorSpace:e},this.finalBuffer),this.currentContext=t({colorSpace:e},this.currentBuffer),this.previousContext=t({colorSpace:e},this.previousBuffer)),s.exactlyEquals(this.size)&&i===this.resolutionScale||(this.resolutionScale=i,this.size=s,this.resizeCanvas(this.context),this.resizeCanvas(this.currentContext),this.resizeCanvas(this.previousContext)),this.background="string"==typeof r?r:r?.serialize()??null}async render(t,e){e&&(this.transformCanvas(this.previousContext),await e.render(this.previousContext)),this.transformCanvas(this.currentContext),await t.render(this.currentContext);const s=this.canvasSize;this.context.clearRect(0,0,s.width,s.height),this.background&&(this.context.save(),this.context.fillStyle=this.background,this.context.fillRect(0,0,s.width,s.height),this.context.restore()),e&&this.context.drawImage(this.previousBuffer,0,0),this.context.drawImage(this.currentBuffer,0,0)}transformCanvas(t){const e=this.canvasSize.scale(.5);t.setTransform(this.resolutionScale,0,0,this.resolutionScale,e.x,e.y)}resizeCanvas(t){const e=this.canvasSize;t.canvas.width=e.width,t.canvas.height=e.height}}class q extends w{set current(t){this.value=t,this.notifySubscribers(t)}get current(){return this.value}constructor(t){super(),this.value=t,this.subscribable=new L(this)}subscribe(t,e=!0){const s=super.subscribe(t);return e&&t(this.value),s}}class L extends S{get current(){return this.dispatcher.current}subscribe(t,e=!0){return this.dispatcher.subscribe(t,e)}}var O;!function(t){t[t.Playing=0]="Playing",t[t.Rendering=1]="Rendering",t[t.Paused=2]="Paused",t[t.Presenting=3]="Presenting"}(O||(O={}));class z{constructor(){this.frame=0,this.speed=1,this.fps=30,this.duration=0,this.finished=!1,this.slides=[],this.previousScene=null,this.state=O.Paused,this.currentSceneReference=null,this.scenes=new q([])}get onSceneChanged(){if(null===this.currentSceneReference)throw new Error("PlaybackManager has not been properly initialized");return this.currentSceneReference.subscribable}get onScenesRecalculated(){return this.scenes.subscribable}get currentScene(){if(null===this.currentSceneReference)throw new Error("PlaybackManager has not been properly initialized");return this.currentSceneReference.current}set currentScene(t){if(!t)throw new Error("Invalid scene.");this.currentSceneReference??(this.currentSceneReference=new q(t)),this.currentSceneReference.current=t}setup(t){this.scenes.current=t,this.currentScene=t[0]}async progress(){return this.finished=await this.next(),this.finished}async seek(t){if(t<=this.frame||this.currentScene.isCached()&&this.currentScene.lastFrame<t){const e=this.findBestScene(t);e!==this.currentScene?(this.previousScene=null,this.currentScene=e,this.frame=this.currentScene.firstFrame,await this.currentScene.reset()):this.frame>=t&&(this.previousScene=null,this.frame=this.currentScene.firstFrame,await this.currentScene.reset())}for(this.finished=!1;this.frame<t&&!this.finished;)this.finished=await this.next();return this.finished}async goBack(){let t=this.currentScene.slides.getCurrent();if(t&&this.currentScene.slides.isWaiting()){const e=this.slides.indexOf(t);t=this.slides[e-1]}await this.seekSlide(t)}async goForward(){const t=this.currentScene.slides.getCurrent(),e=this.slides.indexOf(t);await this.seekSlide(this.slides[e+1])}async goTo(t){await this.seekSlide(this.slides.find((e=>e.id===t)))}async seekSlide(t=null){if(!t)return;const{id:e,scene:s}=t;for((this.currentScene!==s||this.currentScene.slides.didHappen(e))&&(this.previousScene=null,this.currentScene=s,this.frame=this.currentScene.firstFrame,this.currentScene.slides.setTarget(e),await this.currentScene.reset()),this.finished=!1,this.currentScene.slides.setTarget(e);!this.currentScene.slides.isWaitingFor(e)&&!this.finished;)this.finished=await this.next();return this.currentScene.slides.setTarget(null),this.finished}async reset(){this.previousScene=null,this.currentScene=this.scenes.current[0],this.frame=0,await this.currentScene.reset()}reload(t){this.scenes.current.forEach((e=>e.reload(t)))}async recalculate(){this.previousScene=null,this.slides=[];const t=this.speed;this.frame=0,this.speed=1;const e=[];try{for(const t of this.scenes.current)await t.recalculate((t=>{this.frame=t})),this.slides.push(...t.slides.onChanged.current),e.push(t)}finally{this.speed=t}this.scenes.current=e,this.duration=this.frame}async next(){if(this.previousScene&&(await this.previousScene.next(),this.currentScene.isFinished()&&(this.previousScene=null)),this.frame+=this.speed,this.currentScene.isFinished())return!0;if(await this.currentScene.next(),this.previousScene&&this.currentScene.isAfterTransitionIn()&&(this.previousScene=null),this.currentScene.canTransitionOut()){this.previousScene=this.currentScene;const t=this.getNextScene(this.previousScene);t&&(this.currentScene=t,await this.currentScene.reset(this.previousScene)),t&&!this.currentScene.isAfterTransitionIn()||(this.previousScene=null)}return this.currentScene.isFinished()}findBestScene(t){let e=this.scenes.current[0];for(const s of this.scenes.current){if(!s.isCached()||s.lastFrame>t)return s;e=s}return e}getNextScene(t){const e=this.scenes.current;if(!t)return e[0];const s=e.findIndex((e=>e===t));return s<0?null:e[s+1]??null}}class j{get onDataChanged(){return this.data.subscribable}constructor(t){this.logger=t,this.data=new q(null),this.context=new AudioContext,this.audioElement=new Audio,this.source=null,this.error=!1,this.abortController=null,this.offset=0}getTime(){return this.toAbsoluteTime(this.audioElement.currentTime)}setTime(t){this.audioElement.currentTime=this.toRelativeTime(t)}setOffset(t){this.offset=t}setMuted(t){this.audioElement.muted=t}setSource(t){this.source=t,this.audioElement.src=t,this.abortController?.abort(),this.abortController=new AbortController,this.loadData(this.abortController.signal).catch((t=>{"AbortError"!==t.name&&this.logger.error(t)}))}isInRange(t){return t>=this.offset&&t<this.audioElement.duration}toRelativeTime(t){return Math.max(0,t-this.offset)}toAbsoluteTime(t){return t+this.offset}isReady(){return this.source&&!this.error}async setPaused(t){if(this.source&&this.audioElement.paused!==t)if(t)this.audioElement.pause();else try{return await this.audioElement.play(),this.error=!1,!0}catch(t){this.error||f().error(t),this.error=!0}return!1}async loadData(t){if(this.data.current=null,!this.source)return;const e=await fetch(this.source,{signal:t}),s=await e.arrayBuffer();if(t.aborted)return;const i=await this.decodeAudioData(s);if(t.aborted)return;const r=256,n=~~(i.length/r),a=[];let o=0;for(let t=0;t<i.numberOfChannels;t++){const e=i.getChannelData(t);for(let s=0;s<n;s++){const i=~~(s*r),n=~~(i+r);let h=e[i],c=h;for(let t=i;t<n;t++){const s=e[t];s>c&&(c=s),s<h&&(h=s)}(0===t||c>a[2*s])&&(a[2*s]=c),(0===t||h<a[2*s+1])&&(a[2*s+1]=h),c>o&&(o=c),Math.abs(h)>o&&(o=Math.abs(h))}}this.data.current={peaks:a,absoluteMax:o,length:n,sampleRate:i.sampleRate/r*2}}decodeAudioData(t){return new Promise(((e,s)=>this.context.decodeAudioData(t,e,s)))}}class N extends w{async dispatch(t){await Promise.all(this.notifySubscribers(t))}}class B extends w{dispatch(t){this.notifySubscribers(t)}}class F{constructor(t){this.playback=t}secondsToFrames(t){return Math.ceil(t*this.playback.fps)}framesToSeconds(t){return t/this.playback.fps}get time(){return this.framesToSeconds(this.playback.frame)}get frame(){return this.playback.frame}get speed(){return this.playback.speed}get fps(){return this.playback.fps}get state(){return this.playback.state}}class Z{constructor(){this.resolveCurrent=null,this.current=null}async acquire(){for(;this.current;)await this.current;this.current=new Promise((t=>{this.resolveCurrent=t}))}release(){this.current=null,this.resolveCurrent?.(),this.resolveCurrent=null}}class H{get onChanged(){return this.events.subscribable}constructor(t){this.scene=t,this.events=new q([]),this.registeredEvents={},this.lookup={},this.collisionLookup=new Set,this.previousReference=[],this.didEventsChange=!1,this.preserveTiming=!0,this.handleReload=()=>{this.registeredEvents={},this.collisionLookup.clear()},this.handleRecalculated=()=>{this.preserveTiming=!0,this.events.current=Object.values(this.registeredEvents),(this.didEventsChange||(this.previousReference?.length??0)!==this.events.current.length)&&(this.didEventsChange=!1,this.previousReference=Object.values(this.registeredEvents).map((t=>({name:t.name,targetTime:t.targetTime}))),this.scene.meta.timeEvents.set(this.previousReference))},this.handleReset=()=>{this.collisionLookup.clear()},this.handleMetaChanged=t=>{t!==this.previousReference&&(this.previousReference=t,this.load(t),this.scene.reload())},this.previousReference=t.meta.timeEvents.get(),this.load(this.previousReference),t.onReloaded.subscribe(this.handleReload),t.onRecalculated.subscribe(this.handleRecalculated),t.onReset.subscribe(this.handleReset),t.meta.timeEvents.onChanged.subscribe(this.handleMetaChanged,!1)}set(t,e,s=!0){this.lookup[t]&&this.lookup[t].offset!==e&&(this.preserveTiming=s,this.lookup[t]={...this.lookup[t],targetTime:this.lookup[t].initialTime+e,offset:e},this.registeredEvents[t]=this.lookup[t],this.events.current=Object.values(this.registeredEvents),this.didEventsChange=!0,this.scene.reload())}register(t,e){if(this.collisionLookup.has(t))return this.scene.logger.error({message:`name "${t}" has already been used for another event name.`,stack:(new Error).stack}),0;if(this.collisionLookup.add(t),this.lookup[t]){let s=!1;const i={...this.lookup[t]},r=(new Error).stack;i.stack!==r&&(i.stack=r,s=!0),i.initialTime!==e&&(i.initialTime=e,s=!0);const n=Math.max(0,i.targetTime-i.initialTime);this.preserveTiming&&i.offset!==n&&(i.offset=n,s=!0);const a=i.initialTime+i.offset;this.preserveTiming||i.targetTime===a||(this.didEventsChange=!0,i.targetTime=a,s=!0),s&&(this.lookup[t]=i)}else this.didEventsChange=!0,this.lookup[t]={name:t,initialTime:e,targetTime:e,offset:0,stack:(new Error).stack};return this.registeredEvents[t]=this.lookup[t],this.lookup[t].offset}load(t){for(const e of t){const t=this.lookup[e.name]??{name:e.name,initialTime:0,offset:0};this.lookup[e.name]={...t,targetTime:e.targetTime}}}}class G{get onRender(){return this.render.subscribable}get onStateChanged(){return this.playerState.subscribable}get onFrameChanged(){return this.frame.subscribable}get onDurationChanged(){return this.duration.subscribable}get onRecalculated(){return this.recalculated.subscribable}get startFrame(){return Math.min(this.playback.duration,this.status.secondsToFrames(this.startTime))}get endFrame(){return Math.min(this.playback.duration,this.status.secondsToFrames(this.endTime))}get finished(){return this.playback.finished||this.playback.frame>=this.endFrame}constructor(t,e={},s={},i=-1){this.project=t,this.settings=e,this.initialState=s,this.initialFrame=i,this.render=new N,this.frame=new q(0),this.duration=new q(0),this.recalculated=new B,this.lock=new Z,this.startTime=0,this.endTime=1/0,this.requestId=null,this.renderTime=0,this.requestedSeek=-1,this.requestedRecalculation=!0,this.active=!1,this.playerState=new q({loop:!0,muted:!0,speed:1,...s,paused:!0}),this.requestedSeek=i,this.logger=this.project.logger,this.playback=new z,this.status=new F(this.playback),this.audio=new j(this.logger),this.size=e.size??new D(1920,1080),this.resolutionScale=e.resolutionScale??1,this.startTime=e.range?.[0]??0,this.endTime=e.range?.[1]??1/0,this.playback.fps=e.fps??60,this.audio.setOffset(e.audioOffset??0),t.audio&&this.audio.setSource(t.audio);const r=[];for(const e of t.scenes){const s=new e.klass({...e,playback:this.status,logger:this.project.logger,size:this.size,resolutionScale:this.resolutionScale,timeEventsClass:H});e.onReplaced?.subscribe((t=>{s.reload(t)}),!1),s.onReloaded.subscribe((()=>this.requestRecalculation())),s.variables.updateSignals(t.variables??{}),r.push(s)}this.playback.setup(r),this.activate()}async configure(t){await this.lock.acquire();let e=this.playback.frame,s=!1;if(this.startTime=t.range[0],this.endTime=t.range[1],this.playback.fps!==t.fps){const i=t.fps/this.playback.fps;this.playback.fps=t.fps,e=Math.floor(e*i),s=!0}t.size.exactlyEquals(this.size)&&t.resolutionScale===this.resolutionScale||(this.size=t.size,this.resolutionScale=t.resolutionScale,this.playback.reload({size:this.size,resolutionScale:this.resolutionScale})),void 0!==t.audioOffset&&this.audio.setOffset(t.audioOffset),this.lock.release(),s&&(this.playback.reload(),this.frame.current=e,this.requestRecalculation(),this.requestedSeek=e)}requestSeek(t){this.requestedSeek=this.clampRange(t)}requestPreviousFrame(){this.requestedSeek=this.frame.current-this.playback.speed}requestNextFrame(){this.requestedSeek=this.frame.current+this.playback.speed}requestReset(){this.requestedSeek=0}toggleLoop(t=!this.playerState.current.loop){t!==this.playerState.current.loop&&(this.playerState.current={...this.playerState.current,loop:t})}togglePlayback(t=this.playerState.current.paused){t===this.playerState.current.paused&&(this.playerState.current={...this.playerState.current,paused:!t},t&&!this.playerState.current.loop&&this.playback.frame===this.playback.duration&&this.requestReset())}toggleAudio(t=this.playerState.current.muted){t===this.playerState.current.muted&&(this.playerState.current={...this.playerState.current,muted:!t})}setSpeed(t){t!==this.playerState.current.speed&&(this.playback.speed=t,this.playback.reload(),this.playerState.current={...this.playerState.current,speed:t},this.requestRecalculation())}setVariables(t){for(const e of this.playback.onScenesRecalculated.current)e.variables.updateSignals(t)}activate(){this.active=!0,this.request()}deactivate(){this.active=!1,null!==this.requestId&&(cancelAnimationFrame(this.requestId),this.requestId=null)}requestRecalculation(){this.requestedRecalculation=!0,this.request()}async prepare(){const t={...this.playerState.current,seek:this.requestedSeek};if(this.requestedSeek=-1,this.requestedRecalculation){t.seek<0&&(t.seek=this.playback.frame);try{await this.playback.recalculate(),this.duration.current=this.playback.frame,this.recalculated.dispatch()}catch(e){throw this.requestSeek(t.seek),e}finally{this.requestedRecalculation=!1}}(!t.loop&&this.finished&&!t.paused&&t.seek<0||this.endFrame===this.startFrame)&&(this.togglePlayback(!1),t.paused=!0),t.loop&&(t.seek>this.endFrame||this.finished&&!t.paused)&&this.startFrame!==this.endTime&&(t.seek=this.startFrame);const e=t.paused||this.finished||!this.audio.isInRange(this.status.time);return await this.audio.setPaused(e)&&this.syncAudio(-3),this.audio.setMuted(t.muted),t}async run(){const t=await this.prepare(),e=this.playback.state;if(this.playback.state=t.paused?O.Paused:O.Playing,t.seek>=0||!this.isInRange(this.status.frame)){const e=t.seek<0?this.status.frame:t.seek,s=this.clampRange(e);this.logger.profile("seek time"),await this.playback.seek(s),this.logger.profile("seek time"),this.syncAudio(-3)}else{if(t.paused||1===t.speed&&this.audio.isReady()&&this.audio.isInRange(this.status.time)&&this.audio.getTime()<this.status.time)return t.paused&&e!==O.Paused&&await this.render.dispatch(),!t.paused&&this.status.time>this.audio.getTime()+.02&&this.syncAudio(),void this.request();if(this.audio.isReady()&&1===t.speed&&this.audio.isInRange(this.status.time)&&this.status.framesToSeconds(this.playback.frame+1)<this.audio.getTime()-.02){const t=this.status.secondsToFrames(this.audio.getTime());await this.playback.seek(t)}else this.status.frame<this.endFrame&&(await this.playback.progress(),1!==t.speed&&this.syncAudio())}!t.paused&&this.playback.currentScene.slides.isWaiting()&&(this.togglePlayback(!1),t.paused=!0),await this.render.dispatch(),this.frame.current=this.playback.frame,this.request()}request(){this.active&&(this.requestId??(this.requestId=requestAnimationFrame((async t=>{if(this.requestId=null,t-this.renderTime>=1e3/(this.status.fps+5)){this.renderTime=t,await this.lock.acquire();try{await this.run()}catch(t){this.logger.error(t)}this.lock.release()}else this.request()}))))}clampRange(t){return s(this.startFrame,this.endFrame,t)}isInRange(t){return t>=this.startFrame&&t<=this.endFrame}syncAudio(t=0){this.audio.setTime(this.status.framesToSeconds(this.playback.frame+t))}}var W=Object.defineProperty,V=(t,e,s)=>(((t,e,s)=>{e in t?W(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s})(t,"symbol"!=typeof e?e+"":e,s),s);const J=[];class Q extends Error{constructor(t,e){super(t),this.remarks=e}}const Y=[];function $(){const t=Y.at(-1);if(!t)throw new Q("The thread is not available in the current context.","<p><code>useThread()</code> can only be called from within generator functions.\n      It&#39;s not available during rendering.</p>\n");return t}function U(t){return{message:t.message,stack:t.stack,remarks:t.remarks}}const X=180/Math.PI,K=Math.PI/180,_=[];function tt(t,...e){const s={[t.name]:t},i=Object.getOwnPropertyDescriptor(s,t.name);if(i)for(let r=e.length-1;r>=0;r--)e[r](s,t.name,i)}function et(t){return function(e,s,i){i.value.prototype.name=t??s,i.value.prototype.threadable=!0}}function st(t,e){const s=Object.getPrototypeOf(t);s.threadable||(s.threadable=!0,s.name="string"==typeof e?e:function(t){return Object.getPrototypeOf(t).name??null}(e))}class it{constructor(){this.subscribable=new rt(this),this.subscribers=new Set}subscribe(t){return this.subscribers.add(t),()=>this.unsubscribe(t)}unsubscribe(t){this.subscribers.delete(t)}clear(){this.subscribers.clear()}notifySubscribers(t){return[...this.subscribers].map((e=>e(t)))}}class rt{constructor(t){this.dispatcher=t}subscribe(t){return this.dispatcher.subscribe(t)}unsubscribe(t){this.dispatcher.unsubscribe(t)}}class nt extends it{constructor(){super(...arguments),this.value=!1}raise(){this.value||(this.value=!0,this.notifySubscribers())}reset(){this.value=!1}isRaised(){return this.value}subscribe(t){const e=super.subscribe(t);return this.value&&t(),e}}function at(t,e,s){return t+(e-t)*s}function ot(t,e=0,s=1){return at(e,s,t=t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2)}function*ht(t,e,s){const i=$(),r=i.time(),n=i.time()+t;for(e(0,0);n>i.fixed;){const s=i.fixed-r;s>0&&e(s/t,s),yield}i.time(n),e(1,t),null==s||s(1,t)}function*ct(t=0,e){const s=$(),i=function(){const t=_.at(-1);if(!t)throw new Error("The playback is not available in the current context.");return t}().framesToSeconds(1),r=s.time()+t;for(;r-i>s.fixed;)yield;s.time(r),e&&(yield*e)}function lt(t,e){let s;return"string"==typeof t?(s=e(),st(s,t)):(s=t(),st(s,s)),s}tt(ht,et()),tt((function*(t,e){yield*ct(function(t){const e=function(){const t=J.at(-1);if(!t)throw new Error("The scene is not available in the current context.");return t}(),s=$();return e.timeEvents.register(t,s.time())}(t)),e&&(yield*e)}),et()),tt(ct,et());class ut{static collectPromise(t,e=null){const s={promise:t,value:e,stack:(new Error).stack},i=this.collectionStack.at(-1);return i&&(s.owner=i.owner),t.then((t=>{s.value=t,null==i||i.markDirty()})),this.promises.push(s),s}static hasPromises(){return this.promises.length>0}static async consumePromises(){const t=[...this.promises];return await Promise.all(t.map((t=>t.promise))),this.promises=this.promises.filter((e=>!t.includes(e))),t}constructor(t){this.owner=t,this.dependencies=new Set,this.event=new nt,this.markDirty=()=>this.event.raise(),this.invokable=this.invoke.bind(this),Object.defineProperty(this.invokable,"context",{value:this}),Object.defineProperty(this.invokable,"toPromise",{value:this.toPromise.bind(this)})}invoke(){}startCollecting(){if(ut.collectionSet.has(this))throw new Q("A circular dependency occurred between signals.","This can happen when signals reference each other in a loop.\n        Try using the attached stack trace to locate said loop.");ut.collectionSet.add(this),ut.collectionStack.push(this)}finishCollecting(){if(ut.collectionSet.delete(this),ut.collectionStack.pop()!==this)throw new Error("collectStart/collectEnd was called out of order.")}clearDependencies(){this.dependencies.forEach((t=>t.unsubscribe(this.markDirty))),this.dependencies.clear()}collect(){const t=ut.collectionStack.at(-1);t&&(t.dependencies.add(this.event.subscribable),this.event.subscribe(t.markDirty))}dispose(){this.clearDependencies(),this.event.clear(),this.owner=null}async toPromise(){do{await ut.consumePromises(),this.invokable()}while(ut.hasPromises());return this.invokable}}function dt(t){return"function"==typeof t}function pt(t,e){return dt(t)?()=>e(t()):e(t)}ut.collectionSet=new Set,ut.collectionStack=[],ut.promises=[];const yt=Symbol.for("@motion-canvas/core/signals/default");class ft extends ut{constructor(t,e,s=void 0,i=(t=>t),r={}){super(s),this.initial=t,this.interpolation=e,this.parser=i,Object.defineProperty(this.invokable,"reset",{value:this.reset.bind(this)}),Object.defineProperty(this.invokable,"save",{value:this.save.bind(this)}),Object.defineProperty(this.invokable,"isInitial",{value:this.isInitial.bind(this)}),void 0!==this.initial&&(this.current=this.initial,this.markDirty(),dt(this.initial)||(this.last=this.parse(this.initial))),this.extensions={getter:this.getter.bind(this),setter:this.setter.bind(this),tweener:this.tweener.bind(this),...r}}toSignal(){return this.invokable}parse(t){return this.parser(t)}set(t){return this.extensions.setter(t),this.owner}setter(t){return t===yt&&(t=this.initial),this.current===t||(this.current=t,this.markDirty(),this.clearDependencies(),dt(t)||(this.last=this.parse(t))),this.owner}get(){return this.extensions.getter()}getter(){var t,e;if(this.event.isRaised()&&dt(this.current)){this.clearDependencies(),this.startCollecting();try{this.last=this.parse(this.current())}catch(s){((null==(e=J.at(-1))?void 0:e.logger)??console).error({...U(s),inspect:null==(t=this.owner)?void 0:t.key})}this.finishCollecting()}return this.event.reset(),this.collect(),this.last}invoke(t,e,s=ot,i=this.interpolation){return void 0===t?this.get():void 0===e?this.set(t):this.createQueue(s,i).to(t,e)}createQueue(t,e){const s=this.get(),i=[],r=lt("animation chain",(function*(){for(;i.length>0;)yield*i.shift()}));return r.to=(s,n,a=t,o=e)=>(t=a,e=o,i.push(this.tween(s,n,a,o)),r),r.back=(n,a=t,o=e)=>(t=a,e=o,i.push(this.tween(s,n,t,e)),r),r.wait=t=>(i.push(ct(t)),r),r.run=t=>(i.push(t),r),r.do=t=>(i.push(lt((function*(){t()}))),r),r}*tween(t,e,s,i){t===yt&&(t=this.initial),yield*this.extensions.tweener(t,e,s,i),this.set(t)}*tweener(t,e,s,i){const r=this.get();yield*ht(e,(e=>{var n;this.set(i(r,this.parse(dt(n=t)?n():n),s(e)))}))}dispose(){super.dispose(),this.initial=void 0,this.current=void 0,this.last=void 0}reset(){return void 0!==this.initial&&this.set(this.initial),this.owner}save(){return this.set(this.get())}isInitial(){return this.collect(),this.current===this.initial}raw(){return this.current}}class gt extends ft{constructor(t,e,s,i,r=void 0,n={}){var a;super(void 0,i,r,e,n),this.entries=t,this.signals=[],this.parser=e;for(const i of t){let t,n;Array.isArray(i)?([t,n]=i,(a=n.context).owner??(a.owner=this)):(t=i,n=new ft(pt(s,(t=>e(t)[i])),at,r??this.invokable).toSignal()),this.signals.push([t,n]),Object.defineProperty(this.invokable,t,{value:n})}}toSignal(){return this.invokable}parse(t){return this.parser(t)}getter(){return this.parse(Object.fromEntries(this.signals.map((([t,e])=>[t,e()]))))}setter(t){if(dt(t))for(const[e,s]of this.signals)s((()=>this.parser(t())[e]));else{const e=this.parse(t);for(const[t,s]of this.signals)s(e[t])}return this.owner}reset(){for(const[,t]of this.signals)t.reset();return this.owner}save(){for(const[,t]of this.signals)t.save();return this.owner}}var mt,bt,vt,wt;(bt=mt||(mt={}))[bt.Vertical=1]="Vertical",bt[bt.Horizontal=2]="Horizontal",function(t){t[t.Top=4]="Top",t[t.Bottom=8]="Bottom",t[t.Left=16]="Left",t[t.Right=32]="Right"}(vt||(vt={})),function(t){t[t.Middle=3]="Middle",t[t.Top=5]="Top",t[t.Bottom=9]="Bottom",t[t.Left=18]="Left",t[t.Right=34]="Right",t[t.TopLeft=20]="TopLeft",t[t.TopRight=36]="TopRight",t[t.BottomLeft=24]="BottomLeft",t[t.BottomRight=40]="BottomRight"}(wt||(wt={}));class St{static createSignal(t,e=St.lerp,s){return new gt(["x","y"],(t=>new St(t)),t,e,s).toSignal()}static lerp(t,e,s){let i,r;return"number"==typeof s?i=r=s:(i=s.x,r=s.y),new St(at(t.x,e.x,i),at(t.y,e.y,r))}static arcLerp(t,e,s,i=!1,r){return r??(r=t.sub(e).ctg),St.lerp(t,e,function(t,e,s){let i=e;s>1?s=1/s:i=!i;const r=i?Math.acos(function(t,e,s){return s<-1?-1:s>1?1:s}(0,0,1-t)):Math.asin(t),n=at(r,at(0,Math.PI/2,t),s);let a=Math.sin(n),o=1-Math.cos(n);return e&&([a,o]=[o,a]),new St(a,o)}(s,i,r))}static createArcLerp(t,e){return(s,i,r)=>St.arcLerp(s,i,r,t,e)}static fromOrigin(t){const e=new St;return t===wt.Middle||(t&vt.Left?e.x=-1:t&vt.Right&&(e.x=1),t&vt.Top?e.y=-1:t&vt.Bottom&&(e.y=1)),e}static fromScalar(t){return new St(t,t)}static fromRadians(t){return new St(Math.cos(t),Math.sin(t))}static fromDegrees(t){return St.fromRadians(t*K)}static radians(t,e){return Math.atan2(e,t)}static degrees(t,e){return St.radians(t,e)*X}static magnitude(t,e){return Math.sqrt(t*t+e*e)}static squaredMagnitude(t,e){return t*t+e*e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}get magnitude(){return St.magnitude(this.x,this.y)}get squaredMagnitude(){return St.squaredMagnitude(this.x,this.y)}get normalized(){return this.scale(1/St.magnitude(this.x,this.y))}get safe(){return new St(isNaN(this.x)?0:this.x,isNaN(this.y)?0:this.y)}get flipped(){return new St(-this.x,-this.y)}get floored(){return new St(Math.floor(this.x),Math.floor(this.y))}get perpendicular(){return new St(this.y,-this.x)}get radians(){return St.radians(this.x,this.y)}get degrees(){return St.degrees(this.x,this.y)}get ctg(){return this.x/this.y}constructor(t,e){if(this.x=0,this.y=0,null!=t){if("object"!=typeof t)return this.x=t,void(this.y=e??t);if(Array.isArray(t))return this.x=t[0],void(this.y=t[1]);if("width"in t)return this.x=t.width,void(this.y=t.height);this.x=t.x,this.y=t.y}}lerp(t,e){return St.lerp(this,t,e)}getOriginOffset(t){const e=St.fromOrigin(t);return e.x*=this.x/2,e.y*=this.y/2,e}scale(t){return new St(this.x*t,this.y*t)}transformAsPoint(t){return new St(this.x*t.m11+this.y*t.m21+t.m41,this.x*t.m12+this.y*t.m22+t.m42)}transform(t){return new St(this.x*t.m11+this.y*t.m21,this.x*t.m12+this.y*t.m22)}mul(t){const e=new St(t);return new St(this.x*e.x,this.y*e.y)}div(t){const e=new St(t);return new St(this.x/e.x,this.y/e.y)}add(t){const e=new St(t);return new St(this.x+e.x,this.y+e.y)}sub(t){const e=new St(t);return new St(this.x-e.x,this.y-e.y)}dot(t){const e=new St(t);return this.x*e.x+this.y*e.y}mod(t){const e=new St(t);return new St(this.x%e.x,this.y%e.y)}addX(t){return new St(this.x+t,this.y)}addY(t){return new St(this.x,this.y+t)}toSymbol(){return St.symbol}toString(){return`Vector2(${this.x}, ${this.y})`}serialize(){return{x:this.x,y:this.y}}exactlyEquals(t){return this.x===t.x&&this.y===t.y}equals(t,e=1e-6){return Math.abs(this.x-t.x)<=e+Number.EPSILON&&Math.abs(this.y-t.y)<=e+Number.EPSILON}}St.symbol=Symbol.for("@motion-canvas/core/types/Vector2"),St.zero=new St,St.one=new St(1,1),St.right=new St(1,0),St.left=new St(-1,0),St.up=new St(0,1),St.down=new St(0,-1);const kt="motion-canvas-player";class xt extends HTMLElement{constructor(){super(),V(this,"root"),V(this,"canvas"),V(this,"overlay"),V(this,"button"),V(this,"state","initial"),V(this,"project",null),V(this,"player",null),V(this,"defaultSettings"),V(this,"abortController",null),V(this,"mouseMoveId",null),V(this,"finished",!1),V(this,"playing",!1),V(this,"connected",!1),V(this,"stage",new A),V(this,"handleMouseMove",(()=>{this.mouseMoveId&&clearTimeout(this.mouseMoveId),this.hover&&!this.playing&&this.setPlaying(!0),this.mouseMoveId=window.setTimeout((()=>{this.mouseMoveId=null,this.updateClass()}),2e3),this.updateClass()})),V(this,"handleMouseLeave",(()=>{this.hover&&this.setPlaying(!1),this.mouseMoveId&&(clearTimeout(this.mouseMoveId),this.mouseMoveId=null,this.updateClass())})),V(this,"handleMouseDown",(t=>{t.preventDefault()})),V(this,"handleClick",(()=>{this.auto||(this.handleMouseMove(),this.setPlaying(!this.playing),this.button.animate([{scale:"0.9"},{scale:"1",easing:"ease-out"}],{duration:200}))})),V(this,"render",(async()=>{this.player&&await this.stage.render(this.player.playback.currentScene,this.player.playback.previousScene)})),this.root=this.attachShadow({mode:"open"}),this.root.innerHTML='<style>.initial{display:none}.state-initial .initial{display:block}.loading{display:none}.state-loading .loading{display:block}.ready{display:none}.state-ready .ready{display:block}.error{display:none}.state-error .error{display:block}:host{position:relative;display:block}.overlay{position:absolute;left:0;right:0;top:0;bottom:0;display:flex;align-items:center;justify-content:center;opacity:0;background-color:#0000008a;transition:opacity .1s}.overlay.state-ready:not(.auto){cursor:pointer}.overlay.playing:not(.hover):hover{cursor:none}.overlay.hover,.overlay.state-ready:focus-within,.overlay.state-ready:not(.playing){opacity:1}.overlay.hover .button,.overlay.state-ready:focus-within .button,.overlay.state-ready:not(.playing) .button{scale:1;transition:scale .1s ease-out}.overlay.state-loading,.overlay.state-error{opacity:1;transition:opacity 1s}.overlay.state-ready.auto{opacity:0}.button{width:50%;max-width:96px;aspect-ratio:1;scale:.5;transition:scale .1s ease-in,opacity .1s;background-color:transparent;border:none;background-size:100% 100%;background-repeat:no-repeat;opacity:.54;cursor:inherit;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAwIDI0IDI0IiB3aWR0aD0iMjRweCIgZmlsbD0iI2ZmZmZmZiI+PHBhdGggZD0iTTAgMGgyNHYyNEgwVjB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTEyIDJDNi40OCAyIDIgNi40OCAyIDEyczQuNDggMTAgMTAgMTAgMTAtNC40OCAxMC0xMFMxNy41MiAyIDEyIDJ6bS0yIDE0LjV2LTlsNiA0LjUtNiA0LjV6Ii8+PC9zdmc+)}.playing .button{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI0IDI0IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0cHgiIGZpbGw9IiNmZmZmZmYiPjxnPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIvPjwvZz48Zz48Zy8+PHBhdGggZD0iTTEyLDJDNi40OCwyLDIsNi40OCwyLDEyczQuNDgsMTAsMTAsMTBzMTAtNC40OCwxMC0xMFMxNy41MiwyLDEyLDJ6IE0xMSwxNkg5VjhoMlYxNnogTTE1LDE2aC0yVjhoMlYxNnoiLz48L2c+PC9zdmc+)}.button:focus,.overlay:hover .button{opacity:.87}.auto .button{display:none}.canvas{width:100%;display:block;opacity:0;transition:opacity .1s}.canvas.state-ready{opacity:1}.message{font-family:JetBrains Mono,sans-serif;text-align:center;font-size:20px;padding:8px 16px;margin:16px;border-radius:4px;color:#fff9;background-color:#000000de}.loader{width:50%;max-width:96px;display:none;rotate:-90deg;animation:stroke 2s cubic-bezier(.5,0,.5,1) infinite,rotate 2s linear infinite}@keyframes stroke{0%{stroke-dasharray:5.6548667765px 50.8938009883px;stroke-dashoffset:2.8274333882px}50%{stroke-dasharray:50.8938009883px 5.6548667765px;stroke-dashoffset:-2.8274333882px}to{stroke-dasharray:5.6548667765px 50.8938009883px;stroke-dashoffset:-53.7212343766px}}@keyframes rotate{0%{rotate:-110deg}to{rotate:250deg}}\n</style><div class="overlay">\n  <button title="Play / Pause" class="button ready" tabindex="0"></button>\n  <div class="message error">\n    An error occurred while loading the animation.\n  </div>\n  <svg\n    class="loader loading"\n    viewBox="0 0 24 24"\n    stroke="#ffffff"\n    stroke-width="2"\n    fill="transparent"\n  >\n    <circle cx="12" cy="12" r="9" />\n  </svg>\n</div>\n',this.overlay=this.root.querySelector(".overlay"),this.button=this.root.querySelector(".button"),this.canvas=this.stage.finalBuffer,this.canvas.classList.add("canvas"),this.root.prepend(this.canvas),this.overlay.addEventListener("click",this.handleClick),this.overlay.addEventListener("mousemove",this.handleMouseMove),this.overlay.addEventListener("mouseleave",this.handleMouseLeave),this.button.addEventListener("mousedown",this.handleMouseDown),this.setState("initial")}static get observedAttributes(){return["src","quality","width","height","auto","variables"]}get auto(){return!!this.getAttribute("auto")}get hover(){return"hover"===this.getAttribute("auto")}get quality(){const t=this.getAttribute("quality");return t?parseFloat(t):this.defaultSettings.resolutionScale}get width(){const t=this.getAttribute("width");return t?parseFloat(t):this.defaultSettings.size.width}get height(){const t=this.getAttribute("height");return t?parseFloat(t):this.defaultSettings.size.height}get variables(){try{const t=this.getAttribute("variables");return t?JSON.parse(t):{}}catch{return this.project.logger.warn("Project variables could not be parsed."),{}}}setState(t){this.state=t,this.setPlaying(this.playing)}setPlaying(t){var e,s;"ready"===this.state&&(t||this.auto&&!this.hover)?(null==(e=this.player)||e.togglePlayback(!0),this.playing=!0):(null==(s=this.player)||s.togglePlayback(!1),this.playing=!1),this.updateClass()}updateClass(){this.overlay.className=`overlay state-${this.state}`,this.canvas.className=`canvas state-${this.state}`,this.overlay.classList.toggle("playing",this.playing),this.overlay.classList.toggle("auto",this.auto),this.overlay.classList.toggle("hover",null!==this.mouseMoveId),this.connected&&(null===this.mouseMoveId&&this.playing?delete this.dataset.overlay:this.dataset.overlay="")}async updateSource(t){var e,s,i,r;let n;this.setState("initial"),null==(e=this.abortController)||e.abort(),this.abortController=new AbortController;try{const e=import(t),s=new Promise((t=>setTimeout(t,200)));await Promise.any([s,e]),this.setState("loading"),n=(await e).default}catch(t){return console.error(t),void this.setState("error")}this.defaultSettings=n.meta.getFullRenderingSettings();const a=new G(n);a.setVariables(this.variables),this.finished=!1,null==(s=this.player)||s.onRender.unsubscribe(this.render),null==(i=this.player)||i.togglePlayback(!1),null==(r=this.player)||r.deactivate(),this.project=n,this.player=a,this.updateSettings(),this.player.onRender.subscribe(this.render),this.player.togglePlayback(this.playing),this.setState("ready")}attributeChangedCallback(t,e,s){var i;switch(t){case"auto":this.setPlaying(this.playing);break;case"src":this.updateSource(s);break;case"quality":case"width":case"height":this.updateSettings();break;case"variables":null==(i=this.player)||i.setVariables(this.variables)}}disconnectedCallback(){var t,e;this.connected=!1,null==(t=this.player)||t.deactivate(),null==(e=this.player)||e.onRender.unsubscribe(this.render)}connectedCallback(){var t,e;this.connected=!0,null==(t=this.player)||t.activate(),null==(e=this.player)||e.onRender.subscribe(this.render)}updateSettings(){const t={...this.defaultSettings,size:new St(this.width,this.height),resolutionScale:this.quality};this.stage.configure(t),this.player.configure(t)}}customElements.get(kt)||customElements.define(kt,xt)})();